<!DOCTYPE html>
<html>

<head>
    <script src="main.js"></script>
    <style>
        body {
            background-color: var(--uxp-host-background-color, #323232);
            color: var(--uxp-host-text-color, #ffffff);
            font-family: system-ui, sans-serif;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Main Container */
        .main-container {
            width: 320px;
            /* Fixed width as requested */
            margin: 0 auto;
            padding: 12px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: 100%;
            overflow-y: auto;
        }

        /* Header / Tabs */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        /* Tabs - Kitchen Sink Style */
        .sp-tabs {
            flex: 0 0 auto;
            display: flex;
            flex-direction: row;
            border-bottom: 2px solid #3E3E3E;
            width: 100%;
            margin-bottom: 12px;
        }

        .sp-tab {
            margin-right: 12px;
            cursor: pointer;
            padding-bottom: 6px;
        }

        .sp-tab sp-label {
            color: rgba(255, 255, 255, 0.75);
            cursor: pointer;
        }

        .sp-tab:hover sp-label {
            color: white;
        }

        .sp-tab.selected {
            border-bottom: 2px solid white;
            margin-bottom: -2px;
        }

        .sp-tab.selected sp-label {
            color: white;
        }

        /* Sections */
        .section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .row {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .row-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .row-end {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
        }

        /* Components overrides/helpers */
        sp-dropdown {
            width: 100%;
        }

        sp-textfield,
        sp-textarea {
            width: 100%;
        }

        sp-textarea {
            resize: vertical;
            /* Allow vertical resizing */
            min-height: 80px;
        }

        /* Attempt to override border-radius for less round buttons */
        sp-button,
        sp-action-button {
            --spectrum-button-border-radius: 4px;
            /* Some UXP versions might not respect this variable, but worth a try */
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        .full-width {
            width: 100%;
        }

        /* Generation Mode Tabs - shown only in Generate tab */
        #generationModeTabs {
            margin-top: 12px; /* 与 Generate Image 按钮的间距 */
        }

        sp-divider {
            margin: 4px 0;
        }

        .status-message {
            font-size: 11px;
            margin-top: 4px;
            min-height: 20px;
        }

        .status-success {
            color: #2dcc70;
        }

        .status-error {
            color: #ff5555;
        }

        .status-info {
            color: #aaaaaa;
        }

        /* Scrollbar styling for WebKit (UXP uses WebKit) */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #505050;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #606060;
        }
    </style>
</head>

<body>
    <div class="main-container">
        <!-- Header & Tabs -->
        <div class="header">
            <sp-heading size="S" style="margin: 0; text-align: right; font-size: 13px;">PS Banana by LiuYang</sp-heading>
        </div>

        <div class="sp-tabs">
            <div class="sp-tab selected" id="tabGenerate"><sp-label>Generate</sp-label></div>
            <div class="sp-tab" id="tabSettings"><sp-label>Settings</sp-label></div>
        </div>

        <!-- Generate Tab Content -->
        <div id="contentGenerate" class="section">

            <!-- Prompt Presets -->
            <div class="section">
                <sp-label>Prompt Presets</sp-label>
                <sp-dropdown id="presetSelect" placeholder="Select a preset...">
                    <sp-menu slot="options"></sp-menu>
                </sp-dropdown>
                <div class="row-end">
                    <!-- Changed to text buttons for better visibility -->
                    <sp-button id="btnAddPreset" variant="secondary" size="s">Add</sp-button>
                    <sp-button id="btnSavePreset" variant="secondary" size="s">Save</sp-button>
                    <sp-button id="btnRenamePreset" variant="secondary" size="s">Rename</sp-button>
                    <sp-button id="btnDeletePreset" variant="secondary" size="s">Del</sp-button>
                </div>
            </div>

            <!-- Prompt Input -->
            <div class="section">
                <sp-label>Prompt</sp-label>
                <sp-textarea id="promptInput" placeholder="Enter your image generation prompt..."></sp-textarea>
            </div>

            <!-- Resolution & Smart Ratio -->
            <div class="row" style="align-items: flex-end;">
                <div style="flex: 0 0 auto;">
                    <sp-label>Resolution</sp-label>
                </div>
                <div style="flex: 1;">
                    <sp-dropdown id="resolutionSelect" placeholder="Select" style="width: 100%;">
                        <sp-menu slot="options">
                            <sp-menu-item value="1K" selected>1K</sp-menu-item>
                            <sp-menu-item value="2K">2K</sp-menu-item>
                            <sp-menu-item value="4K">4K</sp-menu-item>
                        </sp-menu>
                    </sp-dropdown>
                </div>
                <div style="flex: 1;">
                    <sp-button id="btnSmartCanvasRatio" variant="secondary" style="width: 100%;">Smart Ratio</sp-button>
                </div>
            </div>

            <!-- Toggles -->
            <div class="section">
                <sp-checkbox id="searchWebCheckbox">Search Web (Experimental)</sp-checkbox>
                <sp-checkbox id="selectionModeCheckbox">Generate Only Selection Area</sp-checkbox>
            </div>

            <!-- Generate Button -->
            <sp-button id="btnGenerate" variant="cta" class="full-width">Generate Image</sp-button>

            <!-- Generation Mode Tabs -->
            <div class="sp-tabs" id="generationModeTabs">
                <div class="sp-tab selected" id="tabText2Img"><sp-label>Text to Image</sp-label></div>
                <div class="sp-tab" id="tabImgEdit"><sp-label>Image Edit</sp-label></div>
            </div>

            <!-- Multi-Image Mode (Hidden by default) -->
            <div id="multiImageModeSection" class="section hidden">
                <sp-checkbox id="multiImageModeCheckbox">Use Multi-Image Mode</sp-checkbox>
                <sp-button id="btnEnsureGroups" variant="secondary" class="full-width">New Reference/Source
                    Group</sp-button>
            </div>

            <!-- Status -->
            <div id="generateStatus" class="status-message"></div>

            <!-- Debug Buttons (Hidden) -->
            <div id="debugButtons" class="section hidden">
                <sp-button id="btnTestExport" variant="secondary">Test Export</sp-button>
                <sp-button id="btnTestImport" variant="secondary">Test Import</sp-button>
            </div>
        </div>

        <!-- Settings Tab Content (Hidden by default) -->
        <div id="contentSettings" class="section hidden">

            <!-- Provider Settings -->
            <div class="section">
                <sp-label>Provider</sp-label>
                <sp-dropdown id="providerSelect" placeholder="Select Provider">
                    <sp-menu slot="options"></sp-menu>
                </sp-dropdown>
                <div class="row-end">
                    <sp-button id="btnAddProvider" variant="secondary" size="s">Add</sp-button>
                    <sp-button id="btnSaveProvider" variant="secondary" size="s">Save</sp-button>
                    <sp-button id="btnDeleteProvider" variant="secondary" size="s">Del</sp-button>
                </div>
            </div>

            <sp-button id="btnTestConnection" variant="secondary" class="full-width">Test Connection</sp-button>
            <div id="connectionStatus" class="status-message"></div>

            <sp-divider size="small"></sp-divider>

            <!-- API Config -->
            <div class="section">
                <sp-textfield id="inputApiKey" type="password" placeholder="Enter API Key">
                    <sp-label slot="label">API Key</sp-label>
                </sp-textfield>
                <sp-textfield id="inputBaseUrl" placeholder="https://...">
                    <sp-label slot="label">Base URL</sp-label>
                </sp-textfield>
                <sp-textfield id="inputModelId" placeholder="model-name">
                    <sp-label slot="label">Model ID</sp-label>
                </sp-textfield>
            </div>

            <sp-divider size="small"></sp-divider>

            <!-- Export Settings -->
            <div class="section">
                <sp-heading size="XXS">Export Settings</sp-heading>
                <div class="row">
                    <sp-textfield id="inputMaxSize" type="number" placeholder="2048" min="512" max="8192" step="256"
                        style="flex:1;">
                        <sp-label slot="label">Max Size</sp-label>
                    </sp-textfield>
                    <sp-textfield id="inputQuality" type="number" placeholder="80" min="0" max="100" step="1"
                        style="flex:1;">
                        <sp-label slot="label">Quality</sp-label>
                    </sp-textfield>
                </div>
            </div>

            <sp-divider size="small"></sp-divider>

            <!-- Debug Settings -->
            <div class="section">
                <sp-checkbox id="debugModeCheckbox">Debug Mode</sp-checkbox>
                <sp-textfield id="debugFolderPath" readonly placeholder="Log path will appear here" quiet disabled>
                    <sp-label slot="label">Log File Path</sp-label>
                </sp-textfield>
            </div>
        </div>

        <div class="row-end" style="margin-top: auto; padding-top: 10px;">
            <sp-body size="XS" style="color: #666;">v1.0.0</sp-body>
        </div>
    </div>
</body>

</html>